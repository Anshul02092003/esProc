<!--create by iword1.0 pro, http://www.voland.com.cn-->
<!-- saved from url=(0026)http://www.runqian.com.cn/ -->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=gb2312">
<title>5.5 Second-half ordered grouping</title>
<link rel="stylesheet" href="../images/template.css" type="text/css" />
<link rel="stylesheet" href="document.css" type="text/css" />
<script language="JavaScript" src="../resource/url.js"></script>
</head>

<body>

<div id="content-bg">
	<div id="centent">
	<div id="centent-title"><h2 style='margin-top:8.15pt;margin-right:0cm;margin-bottom:8.15pt;margin-left:
0cm;text-indent:0cm;mso-list:l0 level2 lfo1'><span
lang=EN-US style='mso-fareast-font-family:"Times New Roman"'><span
style='mso-list:Ignore'>5.5<span style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
</span></span></span><span lang=EN-US>Second-half ordered grouping</span></h2></div>
	<p class=MsoNormal><span lang=EN-US>We have handled the &quot;first-half ordered&quot;
situation, then is there something we can take advantage of in the &quot;second-half
ordered&quot; situation?</span></p>

<p class=MsoNormal><span lang=EN-US>Still, we take the account transaction
table as an example, where the data under each account is sorted by date, now
we want to count the total transaction amount under all dates. Since the whole table
is not ordered by date, the ordered grouping algorithm cannot be used. Yet, because
the number of dates in a few years is not large, it still belongs to a small
grouping, which can be easily written with groups():</span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=510
 style='border-collapse:collapse;mso-table-layout-alt:fixed;border:none;
 mso-border-top-alt:black;mso-border-left-alt:black;mso-border-bottom-alt:#B2B2B2;
 mso-border-right-alt:#B2B2B2;mso-border-style-alt:solid;mso-border-width-alt:
 .5pt;mso-yfti-tbllook:1184;mso-padding-alt:0cm 0cm 0cm 0cm;mso-border-insideh:
 .5pt solid #B2B2B2;mso-border-insidev:.5pt solid #B2B2B2'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid;
  height:14.15pt'>
  <td width=47 valign=top style='width:1.0cm;border:solid black 1.0pt;
  border-right:solid windowtext 1.0pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>A</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;page-break-inside:avoid;height:14.15pt'>
  <td width=47 style='width:1.0cm;border-top:none;border-left:solid black 1.0pt;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid black .5pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>1</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=MsoNormal><span class=code><span lang=EN-US style='mso-bidi-font-size:
  10.5pt;font-family:"Times New Roman","serif";mso-fareast-font-family:¿¬Ìå;
  font-weight:normal'>=file(&quot;trades.btx&quot;).cursor@b(dt,amount)</span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes;page-break-inside:avoid;
  height:14.15pt'>
  <td width=47 style='width:1.0cm;border-top:none;border-left:solid black 1.0pt;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid black .5pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>2</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=MsoNormal><span class=code><span lang=EN-US style='mso-bidi-font-size:
  10.5pt;font-family:"Times New Roman","serif";mso-fareast-font-family:¿¬Ìå;
  font-weight:normal'>=A1.groups(dt;sum(amount))</span></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>However, this code does not take advantage
of the characteristic that the data in the account is ordered by date, and remains
a conventional hash grouping mechanism.</span></p>

<p class=MsoNormal><span lang=EN-US>Let¡¯s take this example to explain how to take
advantage of &quot;second-half ordered&quot; situation.</span></p>

<p class=MsoNormal><span lang=EN-US>Assuming that we use the ordered grouping
mechanism to implement the &quot;second-half ordered&quot; situation. In this
way, when traversing the records, we only need to compare the grouping key with
the current last grouped record to determine whether to generate a new group or
accumulate this record. As long as the dt is in order in the same account, errors
will not occur, and the calculation and comparison of hash values can also decrease.
When traversing to the next account, the dt will start resorting, and the dt of
new record may be smaller than that of the current last grouped record. Once this
phenomenon is found, we need to compare this dt with the first record of the current
grouped records to find an appropriate position where we can either accumulate
this record or insert a record, and then traverse the next transaction record.</span><span
lang=EN-US style='font-size:13.5pt;color:black;mso-ansi-language:EN'> </span><span
lang=EN-US>There is no need to compare once again the record that has been
compared in grouped record table because it is also in order, and it will be
compared with the grouped record table from the head again when the next
account is traversed.</span></p>

<p class=MsoNormal><span lang=EN-US>As a result, when the accounts are traversed
one by one, this grouped record table will be compared again and again from the
head to the tail. Every time a record is traversed, the ordered grouping
algorithm only compares it once, but many times of comparison may be needed
before this algorithm can find an appropriate position. However, as long as the
grouped record is compared, it will not be compared again until the next
account is traversed.</span></p>

<p class=MsoNormal><span lang=EN-US>As a whole, the comparison times will
certainly be more than that of ordered grouping, but if most of the data are in
order, the occurrence proportion of comparison from the head (when traversing
to the next account) will be relatively less (within the same account), and the
increased comparison times will not be too many, which may be more advantageous
than hash grouping.</span></p>

<p class=MsoNormal><span lang=EN-US>Here comes a key problem that it may
involve the insertion to grouped record table. The conventional sequential
insertion is a very complex action. To maintain order, it needs to move all the
following members backward to make room, and the complexity of this operation
will offset all the advantages of taking advantages of order. Thus, we need to
use the linked list to maintain the grouped record table, in this way, only the
property of member before and after the insertion point is changed when
inserting, and a large number of members will not be moved. We can't do binary
search after using the linked list, yet the grouped record table is originally
compared in order, therefore it has little impact here.</span></p>

<p class=MsoNormal><span lang=EN-US>SPL also makes this mechanism an option,
which can be used directly:</span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=510
 style='border-collapse:collapse;mso-table-layout-alt:fixed;border:none;
 mso-border-top-alt:black;mso-border-left-alt:black;mso-border-bottom-alt:#B2B2B2;
 mso-border-right-alt:#B2B2B2;mso-border-style-alt:solid;mso-border-width-alt:
 .5pt;mso-yfti-tbllook:1184;mso-padding-alt:0cm 0cm 0cm 0cm;mso-border-insideh:
 .5pt solid #B2B2B2;mso-border-insidev:.5pt solid #B2B2B2'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid;
  height:14.15pt'>
  <td width=47 valign=top style='width:1.0cm;border:solid black 1.0pt;
  border-right:solid windowtext 1.0pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>A</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;page-break-inside:avoid;height:14.15pt'>
  <td width=47 style='width:1.0cm;border-top:none;border-left:solid black 1.0pt;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid black .5pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>1</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=MsoNormal><span class=code><span lang=EN-US style='mso-bidi-font-size:
  10.5pt;font-family:"Times New Roman","serif";mso-fareast-font-family:¿¬Ìå;
  font-weight:normal'>=file(&quot;trades.btx&quot;).cursor@b(dt,amount)</span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes;page-break-inside:avoid;
  height:14.15pt'>
  <td width=47 style='width:1.0cm;border-top:none;border-left:solid black 1.0pt;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid black .5pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>2</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=MsoNormal><span class=code><span lang=EN-US style='mso-bidi-font-size:
  10.5pt;font-family:"Times New Roman","serif";mso-fareast-font-family:¿¬Ìå;
  font-weight:normal'>=A1.groups@h(dt;sum(amount))</span></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>Executing the groups@h() will not use the conventional
hash method but the linked list mechanism mentioned above.</span></p>

<p class=MsoNormal><span lang=EN-US>Big grouping can also perform this kind of
second-half ordered grouping with a similar algorithm. The difference is that when
the grouped record table in memory is large enough to a certain extent, it will
be written out to the buffer file, and then the process will start again, finally,
these buffer files will be merged. Generally, the process is similar to that of
sorting big grouping, and it is also self-adaptively to big grouping and small
grouping.</span></p>

<table class=MsoNormalTable border=1 cellspacing=0 cellpadding=0 width=510
 style='border-collapse:collapse;mso-table-layout-alt:fixed;border:none;
 mso-border-top-alt:black;mso-border-left-alt:black;mso-border-bottom-alt:#B2B2B2;
 mso-border-right-alt:#B2B2B2;mso-border-style-alt:solid;mso-border-width-alt:
 .5pt;mso-yfti-tbllook:1184;mso-padding-alt:0cm 0cm 0cm 0cm;mso-border-insideh:
 .5pt solid #B2B2B2;mso-border-insidev:.5pt solid #B2B2B2'>
 <tr style='mso-yfti-irow:0;mso-yfti-firstrow:yes;page-break-inside:avoid;
  height:14.15pt'>
  <td width=47 valign=top style='width:1.0cm;border:solid black 1.0pt;
  border-right:solid windowtext 1.0pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>&nbsp;</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border:solid windowtext 1.0pt;
  border-left:none;mso-border-left-alt:solid windowtext .5pt;mso-border-alt:
  solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>A</span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:1;page-break-inside:avoid;height:14.15pt'>
  <td width=47 style='width:1.0cm;border-top:none;border-left:solid black 1.0pt;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid black .5pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>1</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=MsoNormal><span class=code><span lang=EN-US style='mso-bidi-font-size:
  10.5pt;font-family:"Times New Roman","serif";mso-fareast-font-family:¿¬Ìå;
  font-weight:normal'>=file(&quot;trades0.btx&quot;).cursor@b()</span></span></p>
  </td>
 </tr>
 <tr style='mso-yfti-irow:2;mso-yfti-lastrow:yes;page-break-inside:avoid;
  height:14.15pt'>
  <td width=47 style='width:1.0cm;border-top:none;border-left:solid black 1.0pt;
  border-bottom:solid black 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid black .5pt;mso-border-alt:solid black .5pt;
  mso-border-right-alt:solid windowtext .5pt;background:#DDDDDD;padding:0cm 0cm 0cm 0cm;
  height:14.15pt'>
  <p class=TabLabel style='margin-top:8.15pt;margin-right:0cm;margin-bottom:
  8.15pt;margin-left:0cm'><span lang=EN-US style='font-family:"Times New Roman","serif"'>2</span></p>
  </td>
  <td width=473 valign=top style='width:10.0cm;border-top:none;border-left:
  none;border-bottom:solid windowtext 1.0pt;border-right:solid windowtext 1.0pt;
  mso-border-top-alt:solid windowtext .5pt;mso-border-left-alt:solid windowtext .5pt;
  mso-border-alt:solid windowtext .5pt;padding:0cm 0cm 0cm 0cm;height:14.15pt'>
  <p class=MsoNormal><span class=code><span lang=EN-US style='mso-bidi-font-size:
  10.5pt;font-family:"Times New Roman","serif";mso-fareast-font-family:¿¬Ìå;
  font-weight:normal'>=A1.groupx@h(id;sum(amount))</span></span></p>
  </td>
 </tr>
</table>

<p class=MsoNormal><span lang=EN-US>Suppose that the trade0 is sorted by date,
and the transactions under the same date are sorted by account, this code can
calculate the total transaction amount of each account at higher performance.</span></p>

<p class=MsoNormal><span lang=EN-US>However, the main cost of big grouping depends
on the writing and reading of buffer files, this algorithm will still have
advantages, but not as significant as small grouping.</span></p>

<p class=MsoNormal><span lang=EN-US>Theoretically, this algorithm works for any
data, and does not necessarily require &quot;second-half ordered&quot;
situation because any data can actually be regarded as second-half ordered
data. However, if the ordered degree is too low, leading to frequent comparison
with grouped record table from the head, the performance will not be comparable
to hash grouping, therefore, attention should be given to the ordered degree of
data when using this algorithm.</span></p>

<p class=MsoNormal><span lang=EN-US>The higher ordered degree in the
second-half, the more obvious the advantages of this algorithm will be. When
the ordered degree reaches the extreme, it becomes an ordered grouping.</span></p>

<p class=MsoNormal><span lang=EN-US>Unlike the method for first-half ordered
situation, which can be used for sorting, this algorithm has little
significance on sorting. The quick sort algorithm commonly used by small sorting
has already taken advantage of the ordered degree of original data, while the
main cost of big sorting depends on the writing and reading of buffer files,
this algorithm does not reduce the number of buffer files, so it has no obvious
advantages.</span></p>

<p class=MsoNormal><span lang=EN-US>Since the grouping operation may involve
aggregation, the actual buffer file is usually smaller than original data, sometimes
much smaller, as a result, the time cost proportion from comparison in memory
will become higher, and the advantages of this algorithm will appear. However,
if each grouping key is almost unique in the whole table, and actual aggregation
rarely occurs, and there is little difference between buffer file and original
table, this algorithm will not have much advantage over hash grouping or sort
grouping.</span></p>
	</div>
	<div id="previous-next">
		<div id="next"><a href="40.html">Next</a></div>
		<div id="previous"><a href="38.html">Previous</a></div>		
	</div>
	<div id="related">
		<div class="related-title"><div class="related-title-left"></div>   Related :</div>
		<div class="related-list"><li><span style='font-family:ËÎÌå;mso-ascii-font-family:"Times New Roman";mso-hansi-font-family:"Times New Roman"'><a href="34.html">5 Ordered traversal</a></span></li>
</div>
	</div>
	<div id="footer">	
		
		
    <div class="copyright"> Copyright&reg; 2021-2023 <a href="http://www.scudata.com" target="_Blank">SCUDATA Inc. 
      </a></div>
	</div>
</div>

</body>
</html>
